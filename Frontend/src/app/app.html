<div class="container">
	@if (errorMessage()) {
		<div class="error-banner">
			{{ errorMessage() }}
			<button (click)="loadItems()">Reintentar</button>
		</div>
	}
	<header>
		<h1>Inventario de Art√≠culos</h1>

		<div class="search-container">
			<input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)" placeholder="üîç Buscar art√≠culo">
		</div>
	</header>

	@if (isLoading()) {
		<div class="loader-wrapper">
			<div class="spinner"></div>
			<p>Cargando art√≠culos...</p>
		</div>
	} @else {
		<div class="grid">
			@for (item of filteredItems(); track item.id) {
				<div class="card">
					<div class="card-image">
						<img [src]="item.imgUrl || 'https:via.placeholder.com/150'" [alt]="item.name">
					</div>
					
					<div class="card-content">
						<h3>{{ item.name }}</h3>
						<p class="stock" [ngClass]="{'low-stock': item.stock < 5}">
							Stock: <strong>{{ item.stock }}</strong> unidades
						</p>
					</div>
					
					<div class="card-actions">
						<button class="btn-edit" (click)="openEditModal(item)">Editar</button>
						<button class="btn-delete" (click)="deleteItem(item.id)">Eliminar</button>
					</div>
				</div>
			} @empty {
				<p>No se encontraron productos</p>
			}
		</div>
	}
</div>

<button class="fab" (click)="openModal()">+</button>

<div class="modal-overlay" *ngIf="showModal">
	<div class="modal-content">
		<h2>{{ isEditing ? 'Editar Art√≠culo' : 'Nuevo Art√≠culo' }}</h2>

		<div class="form-group">
			<label for="name">Nombre</label>
			<input type="text" name="name" [(ngModel)]="newItem.name" placeholder="Ej. Monitor 4K" />
		</div>

		<div class="form-group">
			<label for="img">URL imagen:</label>
			<input type="text" name="img" [(ngModel)]="newItem.imgUrl" placeholder="https://..." />
		</div>

		<div class="form-group">
			<label for="stock">Stock:</label>
			<input type="number" name="stock" [(ngModel)]="newItem.stock" />
		</div>

		<div class="modal-actions">
			<button (click)="closeModal()" class="btn-cancel">Cancelar</button>
			<button (click)="saveItem()" class="btn-save">Guardar</button>
		</div>
	</div>
</div>